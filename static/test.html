<!DOCTYPE html>
<html>
    <body>
        <input type="file" id="image-upload" name="image" accept="image/*" capture>
        <button onclick="requestLocation()">Get Location</button>
        <button onclick="vibrate()">Buzz</button>
    </body>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/exif-js/2.3.0/exif.min.js"></script>
    <script>
        const fileInput = document.getElementById("image-upload");
        
        function vibrate() {
          if (navigator.vibrate) {
            navigator.vibrate([500, 300, 100]);
          }
          EXIF.getData(fileInput.files[0], function () {
              console.log(EXIF.getAllTags(this));
            })
        }

        fileInput.onchange = () => {
            const selectedFile = fileInput.files[0];
            console.log(selectedFile);
        }

        function requestLocation() {
            navigator.geolocation.getCurrentPosition(handleLocation);
        }

        function handleLocation(loc) {
            console.log(loc.coords.latitude, loc.coords.longitude);
            console.log(fileInput.files[0]);

            const file = fileInput.files[0];

            

            let location = {
                "latitude": loc.coords.latitude,
                "longitude": loc.coords.longitude,
                "timestamp": loc.timestamp
            }

            let fd = new FormData();
            fd.append("location", JSON.stringify(location));
            fd.append("file", file);

            fetch('/submit', {
                method: 'POST',
                body: fd
            })
        }

    </script>
</html>