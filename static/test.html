<!DOCTYPE html>
<html>
    <body>
        <input type="file" id="image-upload" name="image" accept="image/*" capture>
        <button onclick="requestLocation()">Get Location</button>
    </body>
    <script>
        const fileInput = document.getElementById("image-upload");
        
        fileInput.onchange = () => {
            const selectedFile = fileInput.files[0];
            console.log(selectedFile);
        }

        function requestLocation() {
            navigator.geolocation.getCurrentPosition(handleLocation);
        }

        function handleLocation(loc) {
            console.log(loc.coords.latitude, loc.coords.longitude);
            console.log(fileInput.files[0]);

            const file = fileInput.files[0];

            let location = {
                "latitude": loc.coords.latitude,
                "longitude": loc.coords.longitude,
                "timestamp": loc.timestamp
            }

            let fd = new FormData();
            fd.append("location", JSON.stringify(location));
            fd.append("file", file);

            fetch('/submit', {
                method: 'POST',
                body: fd
            })
        }
        function getUserPosition() {
            const promiseArray = [];
          
            if (navigator.standalone) {
              promiseArray.push(
                new Promise((resolve, reject) => {
                  const wait = setTimeout(() => {
                    clearTimeout(wait);
                    reject('Location has timed out');
                  }, 4000);
                })
              );
            }
          
            const getCurrentPositionPromise = new Promise((resolve, reject) => {
              if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(resolve, reject, {
                  timeout: 5000,
                  maximumAge: 2000,
                  enableHighAccuracy: true,
                });
              } else {
                reject(new Error('Browser does not support geolocation!'));
              }
            });
          
            promiseArray.push(getCurrentPositionPromise);
          
            return Promise.race(promiseArray);
          }
    </script>
</html>