<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.14.1/css/ol.css" type="text/css">
    <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.14.1/build/ol.js"></script>
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans" />
    <title>boxquest</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
</head>

<style>
    html, body {
        max-width: 100%;
        overflow-x: hidden;
    }
</style>

<body style="background-color: #cd9f61;">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#"
                style="font-family: Open Sans; font-weight: 700;">boxquest</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

        </div>
    </nav>
    <div class="card" style="background-color: white;">
        <div class="card-body">
            <img class="card-img-top" id="output">
            <input type="file" id="image-upload" name="image" accept="image/*" onchange="loadFile(event);" style="display: none;" capture>
            <div class="d-grid gap-2">
                <button class="btn btn-primary btn-lg mb-3" onclick="triggerUpload();">Custom Upload</button>
            </div>
            <div class="input-group mb-3">
                <span class="input-group-text" id="basic-addon1">@</span>
                <input type="text" id="coordinate-display" class="form-control form-control-lg" readonly>
              </div>
              
            <button class="btn btn-primary btn-lg mb-3" style="width: 100%; height: 50px;" onclick="requestLocation();">Get Location</button>
            
            <div class="mb-3">
                <!-- <label for="exampleFormControlTextarea1" class="form-label">Example textarea</label> -->
                <textarea class="form-control form-control-lg" rows="3"></textarea>
              </div>

            <button class="btn btn-primary btn-lg mb-3" style="width: 100%; height: 50px;" onclick="submit();">Submit</button>

        
            
        </div>


    </div>

</body>

<script>
    const fileInput = document.getElementById('image-upload')

    function triggerUpload() {
        fileInput.click();
    }

    function loadFile(event) {
        let image = document.getElementById('output');
        image.src = URL.createObjectURL(event.target.files[0]);
    }

    var map = new ol.Map({
        target: 'map',
        layers: [
            new ol.layer.Tile({
                source: new ol.source.OSM()
            })
        ],
        view: new ol.View({
            center: ol.proj.fromLonLat([37.41, 8.82]),
            zoom: 4
        })
    });

    function requestLocation() {
        navigator.geolocation.getCurrentPosition(handleLocation);
    }

    function handleLocation(loc) {
        console.log(loc.coords.latitude, loc.coords.longitude);
        console.log(fileInput.files[0]);

        const file = fileInput.files[0];

        let location = {
            "latitude": loc.coords.latitude,
            "longitude": loc.coords.longitude,
            "timestamp": loc.timestamp
        }

        console.log(location);

        document.getElementById("coordinate-display").value = `${loc.coords.latitude}, ${loc.coords.longitude}`;

        let fd = new FormData();
        fd.append("location", JSON.stringify(location));
        fd.append("file", file);

        fetch('/submit', {
            method: 'POST',
            body: fd
        })
    }


    let params = new URLSearchParams(window.location.search);

    if (params.has("key")) {
        let box_id = params.get("key");
        sessionStorage.setItem("box_key", box_id);
        window.location.replace(window.location.pathname);
    }

    <!-- document.getElementById("key").innerHTML = sessionStorage.getItem("box_key"); -->
</script>

</html>